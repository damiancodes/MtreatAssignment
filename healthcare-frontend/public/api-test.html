<!DOCTYPE html>
<html>
<head>
    <title>API Test</title>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>
<body>
    <h1>API Test</h1>
    <div id="output"></div>

    <script>
        const API_URL = 'http://127.0.0.1:8001/api';
        const output = document.getElementById('output');

        function log(message) {
            const div = document.createElement('div');
            div.textContent = message;
            output.appendChild(div);
        }

        async function testAPI() {
            try {
                // 1. Register a new patient
                log('Testing patient registration...');
                const patientData = {
                    name: 'Test User',
                    email: 'test@example.com',
                    phone: '+1234567890',
                    date_of_birth: '1990-01-01'
                };
                const registeredPatient = await axios.post(`${API_URL}/patients/`, patientData);
                log('Patient registered: ' + JSON.stringify(registeredPatient.data, null, 2));

                // 2. Login
                log('\nTesting login...');
                const loginResponse = await axios.post(`${API_URL}/token/`, {
                    email: 'test@example.com',
                    password: 'your-password'
                });
                log('Login successful: ' + JSON.stringify(loginResponse.data, null, 2));

                // 3. Get services
                log('\nTesting services endpoint...');
                const servicesResponse = await axios.get(`${API_URL}/services/`);
                log('Services: ' + JSON.stringify(servicesResponse.data, null, 2));

                // 4. Create appointment
                log('\nTesting appointment creation...');
                const appointmentData = {
                    service_id: 1,
                    appointment_date: '2024-03-20T10:00:00Z',
                    notes: 'Test appointment'
                };
                const newAppointment = await axios.post(`${API_URL}/appointments/`, appointmentData, {
                    headers: {
                        'Authorization': `Bearer ${loginResponse.data.access}`
                    }
                });
                log('Appointment created: ' + JSON.stringify(newAppointment.data, null, 2));

                // 5. List appointments
                log('\nTesting appointments list...');
                const appointmentsResponse = await axios.get(`${API_URL}/appointments/`, {
                    headers: {
                        'Authorization': `Bearer ${loginResponse.data.access}`
                    }
                });
                log('Appointments: ' + JSON.stringify(appointmentsResponse.data, null, 2));

            } catch (error) {
                log('Error: ' + (error.response ? JSON.stringify(error.response.data) : error.message));
            }
        }

        // Run the tests
        testAPI();
    </script>
</body>
</html> 